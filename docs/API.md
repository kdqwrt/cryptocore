
## Документация API CryptoCore

### Обзор
CryptoCore — криптографическая библиотека, предоставляющая симметричное шифрование, хеш-функции, коды аутентификации сообщений и функции получения ключей. Этот документ описывает публичный API для разработчиков, интегрирующих CryptoCore в свои приложения.



---

## Модуль: cryptocore.modes

### Класс: `GCM`
Аутентифицированное шифрование в режиме Galois/Counter Mode (GCM).

**Конструктор:**
```python
__init__(key: bytes, nonce: Optional[bytes] = None)
```
- **Параметры:**
  - `key` (bytes): 16-байтный ключ AES-128
  - `nonce` (bytes, опционально): 12-байтный одноразовый номер. Генерируется случайно, если не указан
- **Исключения:**
  - `ValueError`: Если длина ключа ≠ 16 или длина nonce ≠ 12
- **Безопасность:** Использует AES-128 с режимом GCM, обеспечивающим как конфиденциальность, так и аутентификацию

**Методы:**

#### `encrypt(plaintext: bytes, aad: bytes = b"") -> bytes`
Шифрует открытый текст с аутентификацией.

- **Параметры:**
  - `plaintext` (bytes): Данные для шифрования
  - `aad` (bytes): Дополнительные аутентифицированные данные (опционально)
- **Возвращает:** `bytes` в формате: `nonce (12) || ciphertext || tag (16)`
- **Исключения:**
  - `GCMError`: При ошибке шифрования
- **Пример:**
```python
gcm = GCM(key)
ciphertext = gcm.encrypt(b"секретные данные", b"метаданные")
```

#### `decrypt(data: bytes, aad: bytes = b"") -> bytes`
Расшифровывает и проверяет аутентифицированный шифртекст.

- **Параметры:**
  - `data` (bytes): Зашифрованные данные (nonce || ciphertext || tag)
  - `aad` (bytes): Тот же AAD, что использовался при шифровании
- **Возвращает:** `bytes`: Расшифрованный открытый текст
- **Исключения:**
  - `AuthenticationError`: Если проверка тега не удалась
  - `ValueError`: Если неверный формат ввода
- **Безопасность:** Аутентификация выполняется перед расшифровкой

### Класс: `CBCCipher`
Режим Cipher Block Chaining.

**Конструктор:**
```python
__init__(key: bytes, iv: Optional[bytes] = None)
```
- **Параметры:**
  - `key` (bytes): 16-байтный ключ AES-128
  - `iv` (bytes): 16-байтный вектор инициализации (опционально, случайный если None)

**Методы:**

#### `encrypt(data: bytes) -> bytes`
- **Параметры:** `data` (bytes): Открытый текст для шифрования
- **Возвращает:** `bytes`: Зашифрованные данные (IV добавляется в начало)
- **Дополнение:** Использует дополнение PKCS#7
- **Предупреждение безопасности:** Требует правильного управления IV

#### `decrypt(data: bytes) -> bytes`
- **Параметры:** `data` (bytes): Шифртекст (с IV)
- **Возвращает:** `bytes`: Расшифрованные данные
- **Исключения:** `ValueError` при ошибках дополнения

### Классы: `CTRCipher`, `CFBCipher`, `OFBCipher`, `ECBCipher`
Аналогичный интерфейс `CBCCipher`, но с разными режимами.

**Примечание по безопасности:** Режим ECB следует использовать только для тестирования или с одноблочными случайными данными.

---

## Модуль: cryptocore.hash

### Класс: `SHA256`
SHA-256 hash функция .

**Методы:**

#### `update(data: bytes) -> None`
Обрабатывает дополнительные данные.

#### `digest() -> bytes`
- **Возвращает:** 32-байтный хеш
- **Примечание:** Завершает вычисление хеша

#### `hexdigest() -> str`
- **Возвращает:** 64-символьный шестнадцатеричный хеш

**Функции:**

#### `sha256(data: bytes) -> str`
Удобная функция для однократного хеширования.

#### `sha256_bytes(data: bytes) -> bytes`
Бинарная версия.

### Класс: `SHA3_256`
SHA3-256 хеш-функция

Тот же интерфейс, что у `SHA256`.

---

## Модуль: cryptocore.mac

### Класс: `HMAC`
Hash-based Message Authentication Code.

**Конструктор:**
```python
__init__(key: bytes, hash_algorithm: str = 'sha256')
```
- **Параметры:**
  - `key` (bytes): Ключ HMAC (любой длины)
  - `hash_algorithm` (str): 'sha256' или 'sha3-256'
- **Обработка ключа:** Ключи длиннее размера блока хешируются, более короткие ключи дополняются нулями

**Методы:**

#### `compute(message: bytes) -> bytes`
- **Возвращает:** MAC в виде байтов
- **Алгоритм:** HMAC(K, m) = H((K ⊕ opad) || H((K ⊕ ipad) || m))

#### `hexdigest(message: bytes) -> str`
- **Возвращает:** MAC в виде шестнадцатеричной строки

### Класс: `StreamingHMAC`
Потоковый интерфейс для больших данных.

**Методы:**
- `update(data: bytes) -> None`: Добавляет данные постепенно
- `digest() -> bytes`: Завершает и возвращает MAC
- `hexdigest() -> str`: Возвращает MAC в виде hex

---

## Модуль: cryptocore.kdf

### Функция: `pbkdf2(password: str, salt_hex: str, iterations: int = 100000, dklen: int = 32) -> str`
Получение ключей PBKDF2-HMAC-SHA256 (RFC 2898).

- **Параметры:**
  - `password` (str): Пароль пользователя
  - `salt_hex` (str): Соль в hex или строка
  - `iterations` (int): Количество итераций (по умолчанию: 100,000)
  - `dklen` (int): Желаемая длина ключа в байтах
- **Возвращает:** Шестнадцатеричная строка полученного ключа
- **Безопасность:** Рекомендуется высокое количество итераций (>100,000)

### Функция: `derive_key(master_key: bytes, context: str, length: int = 32) -> bytes`
Иерархическое получение ключей.

- **Параметры:**
  - `master_key` (bytes): Корневой ключ
  - `context` (str): Контекст приложения
  - `length` (int): Длина ключа
- **Возвращает:** Полученный ключ в байтах
- **Алгоритм:** В стиле HKDF: HMAC(master_key, context || counter)

---

## Модуль: cryptocore.csprng

### Функция: `generate_random_bytes(num_bytes: int) -> bytes`
Криптографически стойкие случайные байты.

- **Параметры:** `num_bytes` (int): Количество байтов для генерации
- **Возвращает:** Случайные байты
- **Реализация:** Использует `os.urandom()`

### Функции:
- `generate_key() -> bytes`: 16-байтный случайный ключ
- `generate_iv() -> bytes`: 16-байтный случайный IV

---

## Модуль: cryptocore.file_io

### Функции для форматов зашифрованных файлов:

#### `read_gcm_file(filename: str) -> Tuple[bytes, bytes, bytes]`
Читает файл в формате GCM: nonce (12), ciphertext, tag (16).

#### `write_gcm_file(filename: str, nonce: bytes, ciphertext: bytes, tag: bytes)`
Записывает файл в формате GCM.

#### `safe_write_file(filename: str, data: bytes) -> bool`
Атомарная запись файла с использованием временного файла.

---

## Обработка ошибок

### Исключения:

#### `AuthenticationError`
Возникает при неудачной проверке MAC/тега GCM.

#### `GCMError`
Базовый класс для ошибок GCM.

#### `ValueError`
Неверные параметры (длина ключа, формат данных).

### Рекомендации по безопасности в API:

1. **Управление ключами:**
   ```python
   # Хорошо: Генерация случайных ключей
   key = generate_random_bytes(16)
   
   # Плохо: Жестко заданные ключи
   key = b"мой_секретный_ключ_123"
   ```

2. **Выбор режима:**
   ```python
   # Хорошо: Аутентифицированное шифрование
   gcm = GCM(key)
   
   # Избегать: Неаутентифицированные режимы для чувствительных данных
   ecb = ECBCipher(key)  # Только для тестирования
   ```

3. **Безопасность памяти:**
   ```python
   # Чувствительные данные очищаются после использования
   plaintext = decrypt(ciphertext)
   process(plaintext)
   # plaintext автоматически удаляется сборщиком мусора
   ```

---

## Примечания по совместимости

### Версия Python: 3.8+
### Зависимости:
- `pycryptodome` >= 3.14.0

## Информация о версии и совместимости

### Версии 
**Минимальная версия Python:** 3.8.10  
**Статус:** Стабильная версия

### Зависимости и проверенные версии
| Компонент | Версия | Примечание |
|-----------|--------|------------|
| **Python** | 3.8.10 | Основная версия разработки и тестирования |
| **pycryptodome** | 3.23.0 | Криптографические примитивы |
| **pytest** | 8.3.5 | Фреймворк для тестирования |
| **OpenSSL** | 3.6.0 | Совместимость с внешними инструментами |
| **virtualenv** | 20.25.3+ | Управление окружениями |


### Совместимость

**Теоретически совместимо:**
- Python 3.8.0 - 3.8.9

**Не поддерживается:**
- Python 3.7 и ниже
- Python 2.x

#### Операционные системы
 **Протестировано на:**
- **Windows 11** с Python 3.8.10 и OpenSSL 3.6.0
- **Ubuntu 24.04.3 LTS** (Linux)


#### Совместимость с другими инструментами

##### OpenSSL 3.6.0
CryptoCore полностью совместим с OpenSSL 3.6.0 для всех операций:
